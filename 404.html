<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="prefetch" href="/redirects.json">
    <meta content="cootshk.dev" property="og:title" />
    <meta content="Redirecting..." property="og:description" />
    <meta content="#CB641C" data-react-helmet="true" name="theme-color" />
    <title>Redirecting...</title>
    <script>
        function removePrefix(str, prefix) {
            if (str.startsWith(prefix)) 
                return str.substring(prefix.length)
            return str
        }
    </script>
</head>
<body>
    <p>Redirecting...</p>
    <script>
        // redirects.json is regex-matched in order, first match redirects
        fetch("/redirects.json")
            .then(resp => resp.json())
            .then((json) => {
                const path = removePrefix(window.location.href.trim(), "https://cootshk.dev/")
                for (const [key, value] of Object.entries(json)) {
                    if (new RegExp("^"+key, "gmi").test(path)) {
                        console.log(`Matched ${key} to ${path}, redirecting to ${value}!`)
                        open(value, "_self")
                        return;
                    }
                }
                console.error("No redirect found!") // this should never happen as long as we match .* in redirects.json
                open("/", "_self")
            })
    </script>
</body>
</html>
